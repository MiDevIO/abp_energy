package com.misit.abpenergy.HomePageimport android.app.Activityimport android.content.Contextimport android.content.Intentimport android.graphics.Colorimport android.graphics.drawable.ColorDrawableimport android.os.Buildimport androidx.appcompat.app.AppCompatActivityimport android.os.Bundleimport android.view.LayoutInflaterimport android.view.Viewimport android.widget.ImageViewimport android.widget.TextViewimport androidx.appcompat.app.AlertDialogimport com.bumptech.glide.Glideimport com.facebook.shimmer.ShimmerFrameLayoutimport com.misit.abpenergy.Login.FotoProfileActivityimport com.misit.abpenergy.Login.LoginActivityimport com.misit.abpenergy.Master.ListUserActivityimport com.misit.abpenergy.NewIndexActivityimport com.misit.abpenergy.Rimport com.misit.abpenergy.Utils.ConfigUtilimport com.misit.abpenergy.Utils.PrefsUtilimport kotlinx.android.synthetic.main.index_new.*import kotlinx.android.synthetic.main.menu_option.view.*import java.util.*class IndexActivity : AppCompatActivity() ,View.OnClickListener{    private var shimmerLayout: View?=null    private var shimmerSarana:View?=null    private var userRule:Array<String>?=null    var fotoURL:String?=null    override fun onCreate(savedInstanceState: Bundle?) {        super.onCreate(savedInstanceState)        setContentView(R.layout.index_new)        supportActionBar?.hide()        title= "PT ALAMJAYA BARA PRATAMA"        initIndex(this,this)    }    private fun btnListener(click:View.OnClickListener){        fourth_menu_item.setOnClickListener(click)    }    override fun onClick(v: View?) {        if(v?.id==R.id.fourth_menu_item){            profile(this@IndexActivity)        }    }    //    Companion    companion object{        var USERNAME = "username"        var DEPARTMENT="department"        var SECTON="section"        var LEVEL="level"        var Tab_INDEX ="tab_index"        var NAMA_LENGKAP = "nama_lengkap"        var NO_RKB = "NO_RKB"        var TIPE = null        var RULE = "RULE"        var NIK = "NIK"        var COMPANY = "COMPANY"        var PHOTO_PROFILE=false        var INTRO_APP=false    }//    Companion    private fun profile(c:Context){        var mDialogView = LayoutInflater.from(c).inflate(R.layout.menu_option,null)        val nama = mDialogView?.findViewById<View>(R.id.mnNama) as TextView        val nik = mDialogView?.findViewById<View>(R.id.mnNik) as TextView        nama.text = NewIndexActivity.NAMA_LENGKAP        nik.text = NewIndexActivity.NIK        val mnFoto = mDialogView?.findViewById<View>(R.id.mnFoto) as ImageView        Glide.with(c).load(fotoURL).into(mnFoto)        val mBuilder = AlertDialog.Builder(c)        mBuilder.setView(mDialogView)        val dialog =mBuilder.show()        userRule = NewIndexActivity.RULE.split(",").toTypedArray()        var apprSarpras = if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.N) {            Arrays.stream(userRule).anyMatch { t -> t == "master perusahaan" }        } else {            userRule?.contains("master perusahaan")        }        if (apprSarpras!!) {            mDialogView?.btnMasterPerusahaan!!.visibility = View.VISIBLE        }else{            mDialogView?.btnMasterPerusahaan!!.visibility = View.GONE        }        val administrator= if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.N) {            Arrays.stream(userRule).anyMatch { t -> t == "administrator" }        } else {            userRule?.contains("administrator")        }        if (administrator!!) {            mDialogView?.btnListUser!!.visibility = View.VISIBLE        }else{            mDialogView?.btnListUser!!.visibility = View.GONE        }        dialog?.window?.setBackgroundDrawable(ColorDrawable(Color.TRANSPARENT))        mDialogView?.btnListUser!!.setOnClickListener {            val intent = Intent(c, ListUserActivity::class.java)            intent.putExtra(ListUserActivity.DataExtra,"Index")            startActivity(intent)            dialog.dismiss()        }        mDialogView?.dialogDismis!!.setOnClickListener {            dialog.dismiss()        }        mDialogView?.btnChangePWD!!.setOnClickListener {            ConfigUtil.changePassword(c, NewIndexActivity.USERNAME)            dialog.dismiss()        }        mDialogView?.btnKeluarApp!!.setOnClickListener{            ConfigUtil.logOut(this@IndexActivity)            dialog.dismiss()        }        mDialogView?.btnUpdateData!!.setOnClickListener {            dialog.dismiss()        }        mDialogView?.btnUploadFoto!!.setOnClickListener {            uploadProfile()            dialog.dismiss()        }        mDialogView?.btnMasterPerusahaan!!.setOnClickListener {            ConfigUtil.masterPerusahaan(c)            dialog.dismiss()        }    }    private fun uploadProfile(){        val intent = Intent(this@IndexActivity, FotoProfileActivity::class.java)        intent.putExtra("fotoURL",fotoURL)        startActivityForResult(intent,1234)    }    private fun initIndex(c:Context,a:Activity) {        PrefsUtil.initInstance(c)        shimmerLayout = findViewById(R.id.shimmerLayout)        shimmerSarana = findViewById(R.id.shimmerSarana)        btnListener(this@IndexActivity)    }    private fun shimmerToggle(state:Boolean){        if(state){            shimmerLayout?.visibility = View.VISIBLE            shimmerSarana?.visibility = View.VISIBLE        }else{            shimmerLayout?.visibility = View.GONE            shimmerSarana?.visibility = View.GONE        }    }}