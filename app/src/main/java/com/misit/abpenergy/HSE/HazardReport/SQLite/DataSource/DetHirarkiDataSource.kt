package com.misit.abpenergy.HSE.HazardReport.SQLite.DataSourceimport android.content.ContentValuesimport android.content.Contextimport android.database.Cursorimport android.database.sqlite.SQLiteDatabaseimport com.misit.abpenergy.HSE.HazardReport.SQLite.Model.DetHirarkiimport com.misit.abpenergy.SQLite.DbHelperimport es.dmoral.toasty.Toastyclass DetHirarkiDataSource(val c:Context) {    var dbHelper : DbHelper    var sqlDatabase : SQLiteDatabase?=null    var listItem :ArrayList<DetHirarki>?=null    init {        listItem = ArrayList()        dbHelper = DbHelper(c)    }    private fun openAccess(){        sqlDatabase = dbHelper.writableDatabase    }    private fun closeAccess(){        sqlDatabase?.close()        dbHelper?.close()    }    fun insertItem(item: DetHirarki):Long{        openAccess()        var cv = createCV(item)        var hasil = sqlDatabase?.insertOrThrow("$tbItem",null,cv)        closeAccess()        return hasil!!    }    fun getItem(id_hirarki: String): DetHirarki {        openAccess()        val c = sqlDatabase?.rawQuery("SELECT * FROM "+                "$tbItem WHERE id_hirarki = ?", arrayOf(id_hirarki))        c?.moveToFirst()        var itemModels = DetHirarki()        c?.let {            itemModels = fetchRow(it)        }        c?.close()        closeAccess()        return itemModels    }    fun getAll(): ArrayList<DetHirarki> {        val listItem : ArrayList<DetHirarki> = ArrayList()        openAccess()        val c = sqlDatabase?.rawQuery("SELECT * FROM "+                "$tbItem ",null)        if(c!!.moveToFirst()){            do {                listItem?.add(fetchRow(c))            }while (c.moveToNext())        }        c?.close()        closeAccess()        return listItem!!    }    fun getBy(id_hirarki: String): ArrayList<DetHirarki> {        val listItem : ArrayList<DetHirarki> = ArrayList()        openAccess()        val c = sqlDatabase?.rawQuery("SELECT * FROM "+                "$tbItem WHERE id_hirarki = ?", arrayOf(id_hirarki))        if(c!!.moveToFirst()){            do {                listItem?.add(fetchRow(c))            }while (c.moveToNext())        }        c?.close()        closeAccess()        return listItem!!    }    private fun fetchRow(cursor: Cursor): DetHirarki {        val id_ket = cursor.getInt(cursor.getColumnIndex("id_ket"))        val id_hirarki = cursor.getString(cursor.getColumnIndex("id_hirarki"))        val keterangan = cursor.getString(cursor.getColumnIndex("keterangan"))        val ket_input = cursor.getString(cursor.getColumnIndex("ket_input"))        val time_input = cursor.getString(cursor.getColumnIndex("time_input"))        val detHirarki = DetHirarki()        detHirarki.id_ket = id_ket        detHirarki.id_hirarki = id_hirarki        detHirarki.keterangan = keterangan        detHirarki.ket_input = ket_input        detHirarki.time_input = time_input        return detHirarki    }    fun deleteItem(item:Int){        openAccess()        val hasil = sqlDatabase?.delete("$tbItem","id_ket = ? ", arrayOf(item.toString()))        if(hasil!! <0 ){            Toasty.error(c!!,"Gagal Hapus").show()        }else{            Toasty.success(c!!,"Hapus Berhasil").show()        }        closeAccess()    }    fun deleteAll():Boolean{        openAccess()        val hasil = sqlDatabase?.delete("$tbItem",null,null)        if(hasil!! <0 ){            return false        }        closeAccess()        return true    }    fun updateItem(item: DetHirarki, id_ket:Int):Boolean{        openAccess()        val items = ContentValues()        items.put("id_hirarki",item.id_hirarki)        items.put("keterangan",item.keterangan)        items.put("ket_input",item.ket_input)        items.put("time_input",item.time_input)        val hasil = sqlDatabase?.update("$tbItem",items,"id_ket = ?",            arrayOf("${id_ket}"))        if(hasil!! < 0){            return false        }        closeAccess()        return true    }    private fun createCV(item : DetHirarki): ContentValues {        var items = ContentValues()        items.put("id_hirarki",item.id_hirarki)        items.put("keterangan",item.keterangan)        items.put("ket_input",item.ket_input)        items.put("time_input",item.time_input)        return items    }    companion object{        val tbItem = "KET_PENGENDALIAN"    }}