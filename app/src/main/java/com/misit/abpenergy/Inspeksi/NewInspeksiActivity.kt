package com.misit.abpenergy.Inspeksiimport android.content.Intentimport androidx.appcompat.app.AppCompatActivityimport android.os.Bundleimport android.util.Logimport androidx.recyclerview.widget.LinearLayoutManagerimport com.misit.abpenergy.Api.ApiClientimport com.misit.abpenergy.Api.ApiEndPointimport com.misit.abpenergy.Inspeksi.Adapter.ListInspeksiAdapterimport com.misit.abpenergy.Inspeksi.Response.InspeksiGroupsResponseimport com.misit.abpenergy.Inspeksi.Response.ItemsInspeksiModelsimport com.misit.abpenergy.Inspeksi.Response.SubItemsModelsimport com.misit.abpenergy.Login.LoginActivityimport com.misit.abpenergy.Rimport com.misit.abpenergy.Rkb.Response.CsrfTokenResponseimport com.misit.abpenergy.Utils.PopupUtilimport com.misit.abpenergy.Utils.PrefsUtilimport kotlinx.android.synthetic.main.activity_new_inspeksi.*import retrofit2.Callimport retrofit2.Callbackimport retrofit2.Responseimport java.util.*import kotlin.collections.ArrayListclass NewInspeksiActivity : AppCompatActivity() {    private var adapter: ListInspeksiAdapter? = null    private var subItems:MutableList<SubItemsModels>?=null    private var page : Int=1    private var loading : Boolean=false    private var uniqueID:String?=null    private var csrf_token:String?=null    var curentPosition: Int=0    override fun onCreate(savedInstanceState: Bundle?) {        super.onCreate(savedInstanceState)        setContentView(R.layout.activity_new_inspeksi)        val actionBar = supportActionBar        actionBar?.setDisplayHomeAsUpEnabled(true)        uniqueID = UUID.randomUUID().toString()        var idForm = intent.getStringExtra(IDFORM)        var nameForm = intent.getStringExtra(NAMEFORM)        title = "FORM ${nameForm}".capitalize()        PrefsUtil.initInstance(this)        if(PrefsUtil.getInstance().getBooleanState("IS_LOGGED_IN",false)){            USERNAME = PrefsUtil.getInstance().getStringState(PrefsUtil.USER_NAME,"")        }else{            val intent = Intent(this, LoginActivity::class.java)            startActivity(intent)            finish()        }        subItems= ArrayList()        adapter = ListInspeksiAdapter(this@NewInspeksiActivity,idForm,uniqueID!!,            USERNAME,subItems!!)        val linearLayoutManager = LinearLayoutManager(this@NewInspeksiActivity)        rvListInspeksi?.layoutManager = linearLayoutManager        rvListInspeksi.adapter =adapter//        adapter?.setListener(this)        subItems?.clear()        loadInspeksi(idForm!!,page.toString())    }    override fun onResume() {        getToken()        super.onResume()    }    fun loadInspeksi(idforms:String,hal:String){        PopupUtil.showProgress(            this@NewInspeksiActivity,            "Loading...",            "Memuat Form Inspeksi!"        )        val apiEndPoint = ApiClient.getClient(this)!!.create(ApiEndPoint::class.java)        val call = apiEndPoint.getListSubInspeksi(idforms)        call?.enqueue(object : Callback<InspeksiGroupsResponse> {            override fun onFailure(call: Call<InspeksiGroupsResponse>, t: Throwable) {                Log.d("ERRORLOG",t.toString())                PopupUtil.dismissDialog()            }            override fun onResponse(call: Call<InspeksiGroupsResponse>, response: Response<InspeksiGroupsResponse>) {                var listInspeksi = response.body()                if (listInspeksi != null) {                    if (listInspeksi != null) {                        loading = true                        listInspeksi.itemInspeksi!!.forEach {                            val subItem = SubItemsModels()                            var listItemArr: ArrayList<ItemsInspeksiModels>? = null                            listItemArr = ArrayList()                            subItem.nameSub = it.nameSub                            subItem.numSub = it.numSub                            it.items!!.forEach {                                val itemInspeksi = ItemsInspeksiModels()                                itemInspeksi.idForm = it.idForm                                itemInspeksi.idList = it.idList                                itemInspeksi.idSub = it.idSub                                itemInspeksi.listInspeksi = it.listInspeksi                                itemInspeksi.flag = it.flag                                itemInspeksi.tglInput = it.tglInput                                listItemArr.add(itemInspeksi)                            }                            subItem.items = listItemArr                            subItems!!.add(subItem)                        }                        adapter?.notifyDataSetChanged()                    }                }                PopupUtil.dismissDialog()            }        })    }    private fun getToken() {        val apiEndPoint = ApiClient.getClient(this)!!.create(ApiEndPoint::class.java)        val call = apiEndPoint.getToken("csrf_token")        call?.enqueue(object : Callback<CsrfTokenResponse> {            override fun onResponse(                call: Call<CsrfTokenResponse>,                response: Response<CsrfTokenResponse>            ) {                csrf_token = response.body()?.csrfToken            }            override fun onFailure(call: Call<CsrfTokenResponse>, t: Throwable) {                Log.d("csrf_token",t.toString())            }        })    }    override fun onSupportNavigateUp(): Boolean {        onBackPressed()        return super.onSupportNavigateUp()    }    companion object{        var USERNAME="USERNAME"        var IDFORM = "IDFORM"        var NAMEFORM = "NAMEFORM"    }}