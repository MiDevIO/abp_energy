package com.misit.abpenergy.Inspeksiimport androidx.appcompat.app.AppCompatActivityimport android.os.Bundleimport android.util.Logimport android.view.Viewimport android.view.Windowimport android.view.WindowManagerimport androidx.core.content.ContextCompatimport androidx.recyclerview.widget.LinearLayoutManagerimport com.misit.abpenergy.Api.ApiClientimport com.misit.abpenergy.Api.ApiEndPointimport com.misit.abpenergy.Api.ApiEndPointTwoimport com.misit.abpenergy.Inspeksi.Adapter.*import com.misit.abpenergy.Inspeksi.Response.TeamDetailResponseimport com.misit.abpenergy.Inspeksi.Response.TeamInspeksiDetailimport com.misit.abpenergy.Inspeksi.Response.TeamInspeksiTempItemimport com.misit.abpenergy.Inspeksi.Response.TeamInspeksiTempResponseimport com.misit.abpenergy.Rimport com.misit.abpenergy.Utils.PopupUtilimport com.misit.abpenergy.Utils.PrefsUtilimport kotlinx.android.synthetic.main.activity_detail_inspeksi.*import retrofit2.Callimport retrofit2.Callbackimport retrofit2.Responseclass DetailInspeksiActivity : AppCompatActivity() {    private var teamAdapter : TeamDetailAdapter?=null    private var picaAdapter : PicaDetailAdapter?=null    private var teamList:MutableList<TeamInspeksiDetail>?=null    private var picaList:MutableList<ItemPicaDetail>?=null    private var idInspeksi:String?=null    override fun onCreate(savedInstanceState: Bundle?) {        super.onCreate(savedInstanceState)        PrefsUtil.initInstance(this)        val window: Window = this.window        window.addFlags(WindowManager.LayoutParams.FLAG_DRAWS_SYSTEM_BAR_BACKGROUNDS)        window.clearFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS)        window.statusBarColor = ContextCompat.getColor(this, R.color.colorPrimary)        var actionBar = supportActionBar        actionBar?.setDisplayHomeAsUpEnabled(true)        setContentView(R.layout.activity_detail_inspeksi)        idInspeksi = intent.getStringExtra("idInspeksi")        var tglInspeksi = intent.getStringExtra("tglInspeksi")        var perusahaanInspeksi = intent.getStringExtra("perusahaanInspeksi")        var lokasiInspeksi = intent.getStringExtra("lokasiInspeksi")        var saranInspeksi = intent.getStringExtra("saranInspeksi")        var namaInspeksi = intent.getStringExtra("namaInspeksi")        title = namaInspeksi        teamList=ArrayList()        picaList=ArrayList()        pullRefreshNewInspeksi.visibility = View.GONE        lnLoadingNewInspeksi.visibility = View.VISIBLE        val linearLayoutManager1 = LinearLayoutManager(this@DetailInspeksiActivity)        val linearLayoutManager2 = LinearLayoutManager(this@DetailInspeksiActivity)        teamAdapter = TeamDetailAdapter(this@DetailInspeksiActivity,teamList!!)        rvTeamInspeksiDetail?.layoutManager = linearLayoutManager2        rvTeamInspeksiDetail.adapter=teamAdapter        picaAdapter = PicaDetailAdapter(this@DetailInspeksiActivity,picaList!!)        rvPicaInspeksiDetail?.layoutManager = linearLayoutManager1        rvPicaInspeksiDetail.adapter=picaAdapter!!        loadTeamInspeksi(idInspeksi!!)        listPica(idInspeksi!!)    }    private fun listPica(idInspeksi:String){        picaList?.clear()        PopupUtil.showProgress(this@DetailInspeksiActivity,"Loading...","Sedang Memproses . . .!")        val apiEndPoint = ApiClient.getClient(this@DetailInspeksiActivity)!!.create(ApiEndPointTwo::class.java)        val call = apiEndPoint.listInspeksiPica(idInspeksi)        call?.enqueue(object : Callback<InspeksiPicaDetail> {            override fun onResponse(                call: Call<InspeksiPicaDetail>,                response: Response<InspeksiPicaDetail>            ) {                var r = response.body()                if(r!=null){                    picaList?.addAll(r!!.inspeksiPicaDetail!!)                    picaAdapter?.notifyDataSetChanged()                    PopupUtil.dismissDialog()                    pullRefreshNewInspeksi.visibility = View.VISIBLE                    lnLoadingNewInspeksi.visibility = View.GONE                }else{                    PopupUtil.dismissDialog()                }            }            override fun onFailure(call: Call<InspeksiPicaDetail>, t: Throwable) {                PopupUtil.dismissDialog()                Log.d("ErrorPica",t.toString())            }        })    }    private fun loadTeamInspeksi(inpeksiId:String){        PopupUtil.showProgress(this@DetailInspeksiActivity,"Loading...","Memuat Team Inspeksi!")        val apiEndPoint = ApiClient.getClient(this@DetailInspeksiActivity)!!.create(ApiEndPointTwo::class.java)        val call = apiEndPoint.teamInspeksi(inpeksiId)        call?.enqueue(object : Callback<TeamDetailResponse> {            override fun onResponse(                call: Call<TeamDetailResponse>,                response: Response<TeamDetailResponse>            ) {                var r = response.body()                if(r!=null){                    if(r.teamInspeksi!=null)                    {                        var team = r!!.teamInspeksi                        teamList?.addAll(team!!)                        teamAdapter?.notifyDataSetChanged()                        PopupUtil.dismissDialog()                    }else{                        Log.d("ErrorLoadTeam",r.toString())                        PopupUtil.dismissDialog()                    }                    PopupUtil.dismissDialog()                }else{                    Log.d("ErrorLoadTeam",r.toString())                    PopupUtil.dismissDialog()                }            }            override fun onFailure(call: Call<TeamDetailResponse>, t: Throwable) {                Log.d("ErrorLoadTeam",t.toString())                PopupUtil.dismissDialog()            }        })    }}