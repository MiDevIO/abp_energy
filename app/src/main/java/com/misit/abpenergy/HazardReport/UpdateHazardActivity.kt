package com.misit.abpenergy.HazardReportimport android.app.Activityimport android.content.DialogInterfaceimport android.content.Intentimport android.graphics.Bitmapimport android.graphics.BitmapFactoryimport android.net.Uriimport androidx.appcompat.app.AppCompatActivityimport android.os.Bundleimport android.provider.MediaStoreimport android.util.Logimport android.view.Viewimport androidx.appcompat.app.AlertDialogimport com.misit.abpenergy.Rimport es.dmoral.toasty.Toastyimport kotlinx.android.synthetic.main.activity_update_hazard.*import java.io.IOExceptionclass UpdateHazardActivity : AppCompatActivity(),View.OnClickListener {    private var bitmap: Bitmap?=null    private var fileUpload: Uri?=null    private var imgIn:Int=0    override fun onCreate(savedInstanceState: Bundle?) {        super.onCreate(savedInstanceState)        setContentView(R.layout.activity_update_hazard)        FORM_UPLOAD = intent.getBooleanExtra("FORM_UPLOAD",false)        cvUpdateStatus.setOnClickListener(this)    }    override fun onClick(v: View?) {        if(v?.id==R.id.cvUpdateStatus){            showDialogOption()        }    }    override fun onResume() {        if(FORM_UPLOAD){            cvUpdateStatus.visibility= View.VISIBLE        }else{            cvUpdateStatus.visibility= View.GONE        }        super.onResume()    }    override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {        bitmap=null        imgIn=0        if(resultCode== Activity.RESULT_OK && requestCode==222) {            try {//                data.clipData                fileUpload = data!!.data                try {                    bitmap = BitmapFactory.decodeStream(                        contentResolver.openInputStream(fileUpload!!))                    imgUpdateStatus.setImageBitmap(bitmap);                    imgIn = 1                } catch (e: IOException) {                    imgIn = 0                }            } catch (e: IOException) {                imgIn = 0                imgUpdateStatus.visibility=View.GONE            }        }else if(resultCode== Activity.RESULT_OK && requestCode==333){            try {                var dataFoto = data!!                bitmap = BitmapFactory.decodeByteArray(                    dataFoto.getByteArrayExtra("gambarDiFoto"), 0, dataFoto                        .getByteArrayExtra("gambarDiFoto").size                )                imgUpdateStatus.setImageBitmap(bitmap);                imgIn = 1            } catch (e: IOException) {                imgIn = 0                Log.d("IOException",e.printStackTrace().toString())            }        }else if(resultCode== Activity.RESULT_CANCELED){            Toasty.info(this@UpdateHazardActivity,resultCode.toString(),Toasty.LENGTH_SHORT).show()        }        super.onActivityResult(requestCode, resultCode, data)    }    companion object{        var UID = "UID"        var FORM_UPLOAD = false    }    //OPEN GALERY    private fun openGalleryForImage() {//        btnFLMenu.collapse()        val intent = Intent(Intent.ACTION_PICK, MediaStore.Images.Media.EXTERNAL_CONTENT_URI)        intent.type = "image/*"        startActivityForResult(intent, 222)    }    //OPEN GALERY    //    OPEN CAMERA    fun openCamera(){//        btnFLMenu.collapse()        var intent = Intent(this@UpdateHazardActivity,PhotoHazardActivity::class.java)        startActivityForResult(intent,333)    }    //    OPEN    //    Dialog PICK PICTURE    fun showDialogOption(){        val alertDialog = AlertDialog.Builder(this@UpdateHazardActivity)        alertDialog.setTitle("Silahkan Pilih")        val animals = arrayOf<String>(            "Ambil Sebuah Gambar",            "Pilih Gambar dari galery"        )        alertDialog!!.setItems(animals, DialogInterface.OnClickListener{ dialog, which ->            when (which) {                0 -> openCamera()                1 -> openGalleryForImage()            }        })        alertDialog.create()        alertDialog.show()    }    //    Dialog PICK PICTURE}